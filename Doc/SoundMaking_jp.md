# Pico FM Synthesizer Sound Making

![Block Diagram](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/00_splush.jpg)  

Pico FM Synthesizer (PiFMS)での音色の作り方を見てみましょう。  

## 1. 骨格を選ぶ
　PiFMSはFM変調で波形を合成するところから始まります。YAMAHAのDXシリーズなどで有名なFMサウンドと同じような音作りをします。最初は音色の骨格となる「アルゴリズム」を選びます。アルゴリズムはオペレーターのつながり方です。  

### 1-1. オペレーター
　シンセサイザーでは音を波打つ電気信号で作ります。波打つ電気信号を作り出す基本モジュールは発信器です。多くのFMサウンドの楽器と同様に、PiFMSでも発信器をオペレーターと呼ぶことにします。
　PiFMSには4個のオペレーターが入っています。オペレーターが発信する波形には大きく分けて基本波形とサンプリング波形があります。基本波形は数学的に作り出された波形で6種類あり、Noise以外は見るからにシンプルな形をしています。  
　サンプリング波形はPiFMSが持っているサンプリング機能を使って録音した音の一部を切り出して作り出す波形です。サンプリング波形は単純な数式では計算できないような波形にもなります。サンプリング波形はいくつでも用意できます。  
　
|基本波形||
|---|---|
|サイン波|![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/mkg_wave_sine.jpg)|
|鋸歯状波||
|三角波||
|矩形波||
|サイン波の絶対値||
|サイン波のプラス側||
　

## 6. SOUND MAIN
　現在の音色情報を表示します。    
　BANKとSOUNDは現在の音色データを表示しています。ALGOではこの音色に使用するアルゴリズムを変更できます。  

### 6-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/01_sound_main.jpg)  

1) BANK:0  

	音色のバンク番号が表示されています。バンクは0〜9まであります。  
	
2) SOUND:001 Piano  

	音色番号と音色名が表示されています。各バンクに音色番号は000〜999まであります。  
	
3) ALGO:1:<1>+2  

	FM変調のアルゴリズムが表示されます。  
	「<1>+2」のような表記は4つのオペレーターの接続方法を数式のような形式で表しています。  

|記号|意味|
|----|----|
|&lt;n&gt;|オペレーターnがフィードバック可能なことを表します。|
|m*n|オペレーターmでオペレーターnを周波数変調することを表します。|
|m+n|オペレーターmとnの出力を加算合成することを表します。|

	さらに、画面の下側にはアルゴリズムを「<1>-->2-->」のような簡易的な図で表示しています。

|記号|意味|
|----|----|
|&lt;n&gt;|オペレーターnがフィードバック可能なことを表します。|
|m-->n|オペレーターmでオペレーターnを周波数変調することを表します。|
|m+n|オペレーターmとnの出力を加算合成することを表します。|

	例えば、アルゴリズム7の数式は以下の表記になります。
	<1>+2*3+<4>
	
	その図は以下の表示になります。
	<1>-----
	        +
	 2-->3--+-->
	        +
	<4>-----

|値|設定の意味|
|----|----|
|0|アルゴリズム0|
|:|:|
|7|アルゴリズム7|

	アルゴリズムは以下の通りです。

|番号|アルゴリズム|
|----|----|
|0|<1>\*2|
|1|<1>+2|
|2|<1>+2+<3>+4|
|3|(<1>+2\*3)\*4|
|4|<1>\*2\*3\*4|
|5|<1>\*2+<3>\*4|
|6|<1>+<2>\*3\*4|
|7|<1>+2\*3+<4>|


## 7. ALGORITHM
　現在のFM変調アルゴリズムをダイアグラムで表示します。この画面は表示のみで、操作はありません。  

### 7-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/02_algorithm.jpg)  

　以下のアルゴリズムがあります。  

|Algorithm|Diagram|
|---|---|
|0|`<1>-->2-->`|
|1|`<1>--`<br/>`　　　+-->`<br/>`2----`|
|2|`<1>--`<br/>`　　　+`<br/>`2----`<br/>`　　　+-->`<br/>`<3>--`<br/>`　　　+`<br/>`4----`|
|3|`<1>-------`<br/>`　　　　　　+-->4`<br/>`<2>-->3---`|
|4|`<1>-->2-->3-->4`|
|5|`<1>-->2---`<br/>`　　　　　　+-->`<br/>`<3>-->4---`|
|6|`<1>----------`<br/>`　　　　　　　　+-->`<br/>`<2>-->3-->4--`|
|7|`<1>------`<br/>`　　　　　+`<br/>`<2>-->3--+-->`<br/>`　　　　　+`<br/>`<4>------`|
            

## 8. SAMPLING WAVES
　オペレーターの基本波形として利用するサンプリング波形を登録します。最大で4個登録できます。  

### 8-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/03_sampling_waves.jpg) 

1) WAV1:Boh  

	WAVE1にサンプリング波形を登録します。ロータリーエンコーダーRT2を回すことで、SDカードに保存されているサンプリング波形名が順番に表示されます。  
	
2) WAV2:Ah  

	WAVE1にサンプリング波形を登録します。ロータリーエンコーダーRT3を回すことで、SDカードに保存されているサンプリング波形名が順番に表示されます。  
	
3) WAV3:  

	WAVE1にサンプリング波形を登録します。ロータリーエンコーダーRT4を回すことで、SDカードに保存されているサンプリング波形名が順番に表示されます。  
	空欄はサンプリング波形を登録しないことを表します。  
	
4) WAV4:  

	WAVE1にサンプリング波形を登録します。ロータリーエンコーダーRT5を回すことで、SDカードに保存されているサンプリング波形名が順番に表示されます。  


## 9. VCA LFO
　画面サイズの関係で「VCA LFO」とは表示されおらず、最初の設定パラメータ「TREM」で始まります。  
　
### 9-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/04_vca_lfo.jpg) 

### 9-2. TREM (RT1)  

	トレモロのON/OFFを設定します。  
	
### 9-3. TrRT (RT2)  

	トレモロの速さを設定します。  
	
### 9-4. TrSC (RT3)  

	トレモロの深さを設定します。  

### 9-5. BEND (RT4)  

	ビブラートのON/OFFを設定します。  

### 9-6. BdRT (RT5)  

	ビブラートの速さを設定します。  

### 9-7. BdSC (RT6)  

	ビブラートの深さを設定します。  

### 9-8. CURS (RT7)  

	増減する実数値の桁位置を設定します。  


## 10. OSCILLATORS
　「OSCW:」で始まる画面で、4個のオペレーターの発信パラメータを設定します。  
　
### 10-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/05_oscillators.jpg) 　

4オペレーターの切り替えはRT8で行います。先頭行に[1]とある場合はオペレーター1のパラメータ編集画面です。そこでRT8を右に回すと[2]となり、オペレーター2の編集画面になります。  
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/05_oscillators2.jpg) 　

[4]の状態でRT8を右に回すと次の画面に移動します。  

### 10-2. OSCW (RT8)  

	オペレーターの切り替えをします。[n]で表示されている番号nのオペレーターが編集対象となります。  
	
### 10-3. ALGO (---)  

	現在のアルゴリズムを表示しています。  
	
### 10-4. WAVE (RT3)  

	基本波形を設定します。以下の波形があります。  

|表記|波形|
|---|---|
|Sin|Sine wave|
|Tri|Triangle wave|
|Sqr|Square wave (duty=50%)|
|aSi|Absolute value of sine wave|
|+Si|Positive value of sine wave|
|Noi|Noise|
|WV1|Sampling wave1|
|WV2|Sampling wave2|
|WV3|Sampling wave3|
|WV4|Sampling wave4|

	WV1〜4はSAMPLING WAVES画面で登録したサンプリング波形のWAVE1〜4に相当します。サンプリング波形が登録されていない場合はノイズが選択されます。  

### 10-5. FREQ (RT4)  

	発信の1周期内に含める基本波形の数（整数倍）を設定します。  

### 10-6. DETU (RT5)  

	発信の1周期内に含める基本波形の数（小数部）を設定します。  
	一般に、DETUを0以外にしたオペレーターがあると倍音を合成しやすくなります。  

### 10-7. LEVL (RT6)  

	オペレーターの出力振幅レベルを設定します。数値が大きいほど大きな出力となります。  

### 10-8. FDBK (RT7)  

	自分自身のオペレーターにフィードバックする振幅レベルを設定します（フィードバック可能なオペレータでのみ有効です）  

### 10-9. スライドスイッチ  

	スライドスイッチが0のときは上記数値を1ずつ増減します。1のときは5ずつ増減します。  


## 11. WAVE SHAPE
　現在の設定でFM変調された波形を表示します。この画面は表示のみで、操作はありません。  

### 11-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape.jpg)  

　この波形はFM変調直後のものであり、実際にシンセサイザーが出力する波形ではありません。シンセサイザーが出す音は、さらにFILTERとVCAで変調された波形になります。


## 12. OSCILLATOR ENVELOPE
　「OSCA:」で始まる画面で、4個のオペレーターの波形合成用エンベロープを設定します。
　波形合成用エンベロープとVCAのエンベロープは別のものです。VCAエンベロープは1音符の出力ボリュームの変化を表しますが、波形合成用エンベロープはFM変調で波形を合成するときにのみ使用されます。各オペレーターの1周期の基本波形に対して適用され、基本波形1周期の振幅をエンベロープの形に整形します。  
　
### 12-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/08_osc_adsr.jpg) 　

　4オペレーターの切り替えはRT8で行います。先頭行に[1]とある場合はオペレーター1のパラメータ編集画面です。そこでRT8を右に回すと[2]となり、オペレーター2の編集画面になります。  
　[4]の状態でRT8を右に回すと次の画面に移動します。  

### 12-2. OSCA (RT8)  

	オペレーターの切り替えをします。[n]で表示されている番号nのオペレーターが編集対象となります。  
	
### 12-3. StLv (RT2)  

	エンベロープの最初のレベル（スタートレベル）を0.0〜1.0で設定します。
	レベル1.0で基本波形と同じ振幅となり、レベルを0.0にすると波のそのタイミングでは振幅がなくなります。  
	
### 12-4. ATCK (RT3)  

	スタートレベルから1.0にまでスイープする長さを設定します。0〜511で、0は即座に移行することを表します。  

### 12-5. DECY (RT4)  

	アタック完了後にサスティーンレベルまでスイープする長さを設定します。0〜511で、0は即座に移行することを表します。  

### 12-6. SuLv (RT5)  

	ディケイが完了するレベル（サスティーンレベル）を0.0〜1.0で設定します。  

### 12-7. RELS (RT6)  

	サスティーンレベルからエンドレベルにスイープする長さを設定します。0〜511で、0は即座に移行することを表します。  

### 12-8. EdLv (RT7)  

	最終的なレベルを0.0〜1.0で設定します。  

### 12-9. スライドスイッチ  

	スライドスイッチが0のときは上記数値を1ずつ増減します。1のときは5ずつ増減します。  


## 13. FILTER
　「FILT:」で始まる画面で、FM変調された波形に適用するフィルターを設定します。
　
### 13-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/09_filter.jpg) 

### 13-2. FILT (RT1)  

	フィルターの種類を設定します。以下のフィルターがあります。  

|表記|フィルター|
|---|---|
|PASS|フィルターを通さず、FM変調された波形をそのまま出力します。|
|LPF|ローパスフィルターを通した波形を出力します。|
|HPF|ハイパスフィルターを通した波形を出力します。|
|BPF|バンドパスフィルターを通した波形を出力します。|
|NOTCH|ノッチフィルターを通した波形を出力します。|

	
### 13-3. FREQ (RT2)  

	フィルターのカットオフ周波数を設定します。  
	
### 13-4. RESO (RT3)  

	フィルターのQファクター値（レゾナンス）を設定します。  

### 13-5. MODU (RT4)  

	フィルターモジュレーションのON/OFFを設定します。  

### 13-6. LFOr (RT5)  

	フィルターモジュレーション用LFOの速さを設定します。  

### 13-7. LFOf (RT6)  

	フィルターモジュレーション用LFOの深さを設定します。  

### 13-8. CURS (RT7)  

	増減する実数値の桁位置を設定します。  


## 14. FILTER ENVELOPE
　「FILTER ENVELPE」で始まる画面で、FM変調された波形に適用するフィルターのエンベロープ全体の設定をします。
　
### 14-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/14_filter_envelope.jpg) 

### 14-2. INTV (RT2)  

	フィルターエンベロープの時間推移の間隔を指定します。通常の楽器では10〜50程度です。  
	
### 14-3. FQmx (RT3)  

	フィルターのカットオフ周波数の最大変動幅（周波数）を設定します。  

### 14-4. FQrv (RT3)  

	フィルターのカットオフ周波数の変動幅を反転（減少）させるか否かの設定をします。OFFで増加、ONで減少します。  
	
### 14-5. Qfmx (RT3)  

	フィルターのQファクター値の最大変動幅を設定します。  

### 14-6. Qfrv (RT3)  

	フィルターのQファクター値の変動幅を反転（減少）させるか否かの設定をします。OFFで増加、ONで減少します。  

### 14-7. CURS (RT4)  

	増減する実数値の桁位置を設定します。  


## 15. FILTER ENVELOPE ADSR
　「StLv」で始まる画面で、FM変調された波形に適用するフィルターのエンベロープのADSRを設定します。
　
### 15-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/15_filter_adsr.jpg) 
	
### 15-2. StLv (RT2)  

	エンベロープの最初のレベル（スタートレベル）を0.0〜1.0で設定します。
	レベル1.0でFQMxと同じ変動となり、レベルを0.0にするとフィルタの設定値のままとなります。  
	
### 15-3. ATCK (RT3)  

	スタートレベルから1.0にまでスイープする長さを設定します。0〜511で、0は即座に移行することを表します。  

### 15-4. DECY (RT4)  

	アタック完了後にサスティーンレベルまでスイープする長さを設定します。0〜511で、0は即座に移行することを表します。  

### 15-5. SuLv (RT5)  

	ディケイが完了するレベル（サスティーンレベル）を0.0〜1.0で設定します。  

### 15-6. SuRs (RT6)  

	サスティーンレベルからエンドレベルにスイープする長さを設定します。0〜511で、0は即座に移行することを表します。  

### 15-7. EdLv (RT7)  

	最終的なレベルを0.0〜1.0で設定します。  

### 15-8. CURS (RT4)  

	増減する実数値の桁位置を設定します。  


## 16. VCA
　「VCA」で始まる画面で、FM変調された波形に適用するVCAのエンベロープを設定します。
　
### 16-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/10_vca.jpg) 

### 16-2. ATCK (RT2)  

	エンベロープのアタック秒数を設定します。  
	
### 16-3. DECY (RT3)  

	エンベロープのディケイ秒数を設定します。  
	
### 16-4. SuLv (RT4)  

	エンベロープのサスティーンレベルを0.0〜1.0で設定します。  

### 16-5. SuRs (RT5)  

	エンベロープのリリース秒数を設定します。  

### 16-6. CURS (RT6)  

	増減する実数値の桁位置を設定します。  


## 17. SAVE
　「SAVE」で始まる画面で、現在の音色パラメータをSDカードに保存します。
　
### 17-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/11_save.jpg) 

### 17-2. BANK (RT2)  

	保存先のバンク番号を設定します。  
	
### 17-3. SOND (RT3)  

	保存先のプログラム番号を設定します。
	保存済みのデータがあるとその音色名も表示されます。  
	
### 17-4. NAME (RT4)  

	音色名を設定します。  

### 17-5. CURS (RT5)  

	増減する実数値の桁位置を設定します。  

### 17-6. TASK (RT6)  

	セーブを実行します。
	RT6を回すと「Save?」と確認表示が出ます。さらにRT6を回すと実際にセーブされます。  


## 18. LOAD
　「SAVE」で始まる画面で、現在の音色パラメータをSDカードに保存します。
　
### 18-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/12_load.jpg) 

### 18-2. BANK (RT2)  

	ロードする音色のあるバンク番号を設定します。  
	
### 18-3. SOND (RT3)  

	ロードする音色のプログラム番号を設定します。
	番号を指定するのではなく、存在する音色リストからの選択になります。  
	
### 18-4. NAME (RT4)  

	ロード対象の音色リストをサーチする文字列を設定します。
	この文字列と部分一致する音色名のみがSOND欄にリストされます（3文字以上のときのみ動作します。3文字以下では全件マッチします）  

### 18-5. CURS (RT5)  

	増減する実数値の桁位置を設定します。  

### 18-6. TASK (RT6)  

	サーチとロードを実行します。
	RT6を左に回すと「Search?」と確認表示が出ます。さらにRT6を左に回すと実際にサーチが行われます。  
	RT6を右に回すと「Load?」と確認表示が出ます。さらにRT6を右に回すと実際にサーチが行われます。  


## 19. SAMPLING
　「SAMPLING」で始まる画面で、マイクで拾った音をサンプリングしてサンプリング波形としてSDカードに保存します。
　
### 19-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/13_sampling.jpg) 

### 19-2. TIME (RT2)  

	サンプリングする時間単位を設定します。
	通常は1で利用します。値を大きくすると波形が複雑になることがあります。  
	
### 19-3. WAIT (RT3)  

	サンプリング実施を指示してから、実際にサンプリングが始まる秒数を指定します。  
	サンプリング前にはLED6が赤く3回点滅し、次に1度青く光り、その直後にサンプリングが開始されます。サンプリング中は緑に点灯しています。  
	
### 19-4. CUT (RT4)  

	サンプリングした波形の振幅値を丸める単位を指定します。この値が小さいとノイズが多く乗った波形となることが多く、音源としては使いにくくなります。  
	
### 19-5. NAME (RT5)  

	サンプリングした波形の名前を設定します。  

### 19-6. CURS (RT6)  

	増減する実数値の桁位置を設定します。  

### 19-7. TASK (RT7)  

	サーチとロードを実行します。
	RT6を左に回すと「Search?」と確認表示が出ます。さらにRT6を左に回すと実際にサーチが行われます。  
	RT6を右に回すと「Load?」と確認表示が出ます。さらにRT6を右に回すと実際にサーチが行われます。  
	
	
　
