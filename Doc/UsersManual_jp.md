# Pico FM Synthesizer User's Manual

![Block Diagram](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/00_splush.jpg)  
## 1. 機能
　Pico FM SynthesizerはUSB MIDIデバイスとして動作するシンセサイザーです。Pico FM Synthesizerを以降、「本機」または「PiFM+S」と略す場合があります。  

### 1-1. 機能ブロック  
　以下の機能を持っています。  

|分類|機能|説明|
|---|---|---|
|波形|基本波形|6種類の基本波形|
||サンプリング波形|サンプラーで作成した波形（個数上限なし）|
|波形合成|FM合成|4オペレーター、11アルゴリズム|
||加算合成|8オシレーター|
||合成制御|出力エンベロープ|
|VCO|発音|12ボイス|
||VCO制御|LFOトレモロ|
|||LFOビブラート|
|||ポルタメント|
||MIDI IN|ピッチベンド|
|||LFOトレモロ|
|||LFOビブラート|
|フィルター|フィルター種別|LPF, HPF, BPF, NOTCH|
||フィルター制御|LFOモジュレーション|
|||エンベロープ|
|||ベロシティー|
||MIDI IN|LFOモジュレーション|
||エフェクター|エコー|
|VCA|VCA制御|エンベロープ|
|||ベロシティー|
|トイ・サンプラー|入力|マイク|
||編集|波形丸め|
|ファイル|音色|SAVE, LOAD|
||FM変調波形|SAVE|
||サンプリング波形|SAVE|
|出力|DAC|PCM5102Aによるオーディオ出力|

　以下の仕組みでこれらの機能を実装しています。  
![Block Diagram](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/PiFMSynth_Block_Diagram.png)  

|略号|説明|
|---|---|
|MIC|マイク|
|SMP|サンプラー|
|USB|USBケーブルおよびポート|
|UMI|USB MIDI IN|
|FMWG|FM波形合成|
|ALG|FM合成アルゴリズム|
|ADWG|加算波形合成|
|ADSR|エンベロープジェネレーター|
|LFO|Low Frequency Oscillator|
|FLT|フィルター|
|AMP|VCA|
|DAC|Digital Audio Convertor|
|8Encoders|8個のロータリーエンコーダー|
|OLED|ディスプレイ|　

### 1-2. 波形合成
![PiFMS](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/PiFMS_Wave_Synthesis.png)  

　音色の波形合成には3つの方法があります。  

(1) FM合成（FM Synthesis）  
　4オペレーター、11アルゴリズムのFM方式による波形合成です。金属的な音色の合成に適しています。  

(2) 加算合成（Additive Synthesis）  
　最大8個のサイン波を加算して波形を合成します。管楽器や弦楽器のようにいくつかの倍音で形成されているような音色の合成に適しています。  
　FM合成の4オペレーターも加えると最大で12個のサイン波を加算合成できます。  

(3) FM＋加算合成  
　FM合成した音色と加算合成した音色を加算して波形合成できます。それぞれの特長を合わせた波形合成ができます。  
  

## 2. 外観
![PiFM+S](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/PiFMSynth.jpg)  

1) ロータリーエンコーダー  

	8個のロータリーエンコーダー（RT1〜RT8）で各種設定を行います。
	また、右端にあるスライドスイッチもいくつかの機能を持ちます。ロータリーエンコーダーに対応したLEDで操作をサポートすることもあります。  
	
2) OLEDディスプレイ  

	各種情報を表示します。  
	
3) USBコネクタ（外付け）  

	本機をUSBホストとして使用するとき、ここにUSB OTGケーブルを接続します。電源はOTGケーブルから供給します。  
	
4) USBコネクタ（PICO2オンボード）  

	本機のメンテナンス時と、本機をUSBデバイスとして使用するときに通常のUSBケーブルを接続します。  
	
5) マイク  

	音をサンプリングするときに使用します。  
	
6) SDカード  

	作成した音色やサンプリングした波形を保存できます。  

![PiFM+S](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/PiFMS_components.jpg)  

## 3. 注意事項
　USB OTGケーブルと通常のUSBケーブルの両方を同時に接続している状態では、OTGケーブル側から電源を供給しないで下さい。  

## 4. 接続〜起動
![Block Diagram](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/00_splush.jpg)   

### 4-1. USBデバイスモード
1) PiFM+S（本機）を用意し、ロータリーエンコーダーのスライドスイッチを1にします。  
2) USBホストとなるパソコンなどを用意します。  
3) PiFM+Sとパソコンを接続するUSBケーブルを用意します。PiFM+S側はRapsberry Pi PICO2WのMicro USB-Bオスです。  
4) PiFM+SのUSBコネクタとパソコンをUSBケーブルで接続します。  
5) MIDI音源の電源を入れます。パソコンからUSBケーブルで電源が供給されると、PiFM+Sが起動してOLED画面に「**PiFM Synth**」と表示されます。  
6) OLED画面が「**SOUND MAIN**」という演奏用画面になると演奏できます。  
　この画像は、Macと接続したものです。  
![Connect to Mac](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/usb_to_mac.jpg)

### 4-2. USBホストモード
1) PiFM+S（本機）を用意し、ロータリーエンコーダーのスライドスイッチを0にします。  
2) USBデバイスとなるUSB MIDIキーボードなどを用意します。  
3) PiFM+SとUSB MIDIキーボードを接続するUSBケーブルを用意します。  
4) PiFM+SのOTGケーブルのUSBコネクタとUSB MIDIキーボードをUSBケーブルで接続します。  
5) OTGケーブルの電源供給用USBケーブルを5VのACアダプターに接続します。OTGケーブルからUSBケーブルで電源が供給されると、PiFM+Sが起動してOLED画面に「**PiFM Synth**」と表示されます。  
6) OLED画面が「**SOUND MAIN**」という演奏用画面になると演奏できます。  
　この画像は、KORG nanoKEY2と接続したものです。  
![Connect to OTG](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/usb_otg.jpg)


## 5. 操作の基本
　ここでは基本的な操作方法を説明します。  

### 5-1. ロータリーエンコーダーRT1〜RT7
　ロータリーエンコーダーのRT1〜RT7は、OLEDの画面の各行に対応し、その行の設定を変更します。設定内容によって以下の動作をします。  

|データ型|左回転|右回転|
|---|---|---|
|整数|数値減少|数値増加|
|実数|数値減少|数値増加|
|文字|文字コード手前|文字コード後ろ|
|リスト|リスト手前|リスト後ろ|
|CURSOR|カーソル手前移動|カーソル後ろ移動|

　OLED画面に「CURS」という行がある場合、その画面の整数、実数、文字の設定値の増減はカーソル位置の桁への操作になります。カーソル位置はCURS行の「^」の位置で示されます。これにより、0〜1000まで幅のあるような設定値も、桁を指定して容易に大きな値を増減できます。  
　OSCILLATORS画面とOSCILLATOR ADSR画面にはCURS機能はありませんが、スライドスイッチを0にすると数値が1ずつ、スライドスイッチを1にすると数値が5ずつ増減します。
　
### 5-2. ロータリーエンコーダーRT8
　ロータリーエンコーダーのRT8は画面の表示内容を変更します。右に回すと次のページへ、左に回すと手前のページに移動します。また、ロータリーエンコーダーのボタンスイッチBT1〜BT7を押すことで目的のページへショートカットすることもできます。  
　ページは以下の通りです。BT4x2はボタンBT4を2回押すことを意味します。  s

|ページ|内容|ショートカット|
|---|---|---|
|SOUND MAIN|現在の音色の情報を表示します。|BT1|
|ALGORITHM|現在のアルゴリズムのダイアグラムを表示します。||
|SAMPLING WAVES|オペレーターに利用できるサンプリング波形を設定します。|BT5x2|
|OSCILLATOR LFO|OSCILLATORに適用するLFOを設定します。|BT4x2|
|OSCILLATORS|4個のオペレーターの発信設定をします。|BT2|
|WAVE SHAPE|FM変調された結果の波形を表示し、波形データの保存もできます。|BT2x2|
|OSCILLATOR ADSR|4個のオペレーターの波形エンベロープを設定します。||
|FILTER|フィルターを設定します。|BT3|
|FILTER ENVELOPE|フィルターエンベロープの全体設定をします。|BT3x2|
|FILTER ADSR|フィルターエンベロープのADRSを設定します。|BT3x3|
|VCA|VCAのエンベロープを設定します。|BT4|
|SAVE|音色を保存します。|BT6|
|LOAD|音色を読み込みます。|BT7|
|SAMPLING|音をサンプリングして保存します。|BT5|
　
### 5-3. 音色設定変更のタイミング
　音色のパラメータ値変更によるシンセサイザーの設定には1〜3秒程度かかることがあります。そのためパラメーター変更があった場合のシンセサイザーの音色設定変更は以下のタイミングで実施しています。  

　1) パラメーター変更が一定時間なかったとき。  
　2) MIDI-INがあったとき。  

　この処理の間はパラメーター変更や演奏はできません。1〜3秒程度で終わるのでそれを待って下さい。この処理の間はPICO2のボード上の緑色のLEDが点灯します。

## 6. SOUND MAIN
　現在の音色情報を表示します。    
　BANKとSOUNDは現在の音色データを表示しています。ALGOではこの音色に使用するアルゴリズムを変更できます。  

### 6-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/01_sound_main.jpg)  

### 6-2. H:0 001 Grand Piano  

	先頭の「H:」はUSBホストモードで起動していることを表しています。デバイスモードのときは「D:」になります。  
	その右には、音色のバンク番号、音色番号、音色名が表示されています。  
	
### 6-3. ALGO:1:<1>+2 (RT2) 

	FM変調のアルゴリズムが表示されます。RT2を左右に回すことでアルゴリズムを変更できます。  
	「<1>+2」のような表記は4つのオペレーターの接続方法を数式のような形式で表しています。  

|記号|意味|
|----|----|
|&lt;n&gt;|オペレーターnがフィードバック可能なことを表します。|
|m*n|オペレーターmでオペレーターnを周波数変調することを表します。|
|m+n|オペレーターmとnの出力を加算合成することを表します。|

	アルゴリズムは以下の通りです。

|番号|アルゴリズム|
|----|----|
|0|<1>\*2|
|1|<1>+2|
|2|<1>+2+<3>+4|
|3|(<1>+2\*3)\*4|
|4|<1>\*2\*3\*4|
|5|<1>\*2+<3>\*4|
|6|<1>+<2>\*3\*4|
|7|<1>+2\*3+<4>|
|8|<1>\*(2+3)+<4>|
|9|<1>\*(2\*3+4)|
|10|<1>\*(2+3+4)|
	
### 6-4. VOLM:5 (RT3) 

	マスターボリュームの値を1〜9の範囲で変更できます。    
	
### 6-5. UNIS:1 (RT4) 

	ユニゾン発音を0〜9の範囲で変更できます。  
	0のときは非ユニゾンモードで1つの音程を1つの音で発音します。    
	1以上のときは元の音程に加えて、この値の周波数(Hz)だけずらした音も同時発音するユニゾンモードになります。これによって音色の重厚さが増すことがあります。  
	ユニゾンモードでは最大同時発音数が半分の6になります。  

### 6-6. PBND: 2 (RT5) 

	MIDI INでピッチベンドを受信したときにピッチベンドする音程を指定します。PBENDが2でC4を発音しているとき、高音方向へのピッチベンドを受信するとD4までピッチベンドします。低音側だとA3#までピッチベンドします。  
	ピッチベンドさせたくないときはPBNDを0にします。  

### 6-7. PORT: +0.000 (RT6) 

	ポルタメントする時間を秒数で指定する場合はプラスの数値で設定します。  
	ポルタメントを一定時間に一定音程で変化させたい場合はマイナスの数値で設定します。半音変化させる秒数（のマイナスの値）を設定します。  
	ポルタメントさせたくないときはPORTを0にします。  

### 6-8. CURS (RT7)  

	増減する実数値の桁位置を設定します。  

## 7. ALGORITHM
　現在のFM変調アルゴリズムをダイアグラムで表示します。この画面は表示のみで、操作はありません。  

### 7-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/02_algorithm.jpg)  

　以下のアルゴリズムがあります。  

|Algorithm|Diagram|
|---|---|
|0|`<1>-->2-->`|
|1|`<1>--`<br/>`　　　+-->`<br/>`2----`|
|2|`<1>--`<br/>`　　　+`<br/>`2----`<br/>`　　　+-->`<br/>`<3>--`<br/>`　　　+`<br/>`4----`|
|3|`<1>-------`<br/>`　　　　　　+-->4`<br/>`<2>-->3---`|
|4|`<1>-->2-->3-->4`|
|5|`<1>-->2---`<br/>`　　　　　　+-->`<br/>`<3>-->4---`|
|6|`<1>----------`<br/>`　　　　　　　　+-->`<br/>`<2>-->3-->4--`|
|7|`<1>------`<br/>`　　　　　+`<br/>`<2>-->3--+-->`<br/>`　　　　　+`<br/>`<4>------`|
|8|`　　　-->2--`<br/>`<1>-\|　　　 \|`<br/>`　　　-->3--+-->`<br/>`　　　　　　 \|`<br/>`<4>--------`|
|9|`　　　-->2-->3--`<br/>`<1>-\|　　　　　　+-->`<br/>`　　　-->4------`|
|10|`　　　 -->2---`<br/>`　　　\|　　　　\|`<br/>`<1>--+-->3---+-->`<br/>`　　　\|　　　　\|`<br/>`　　　 -->4---`|
            

## 8. SAMPLING WAVES
　オペレーターの基本波形として利用するサンプリング波形を登録します。最大で4個登録できます。  

### 8-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/03_sampling_waves.jpg) 

### 8-2. WAV1 (RT2)  

	WAVE1にサンプリング波形を登録します。ロータリーエンコーダーRT2を回すことで、SDカードに保存されているサンプリング波形名が順番に表示されます。  

### 8-3. WAV2 (RT3)  

	WAVE1にサンプリング波形を登録します。ロータリーエンコーダーRT3を回すことで、SDカードに保存されているサンプリング波形名が順番に表示されます。  

### 8-4. WAV3 (RT4)  

	WAVE1にサンプリング波形を登録します。ロータリーエンコーダーRT4を回すことで、SDカードに保存されているサンプリング波形名が順番に表示されます。  
	空欄はサンプリング波形を登録しないことを表します。  

### 8-5. WAV4 (RT5)  

	WAVE1にサンプリング波形を登録します。ロータリーエンコーダーRT5を回すことで、SDカードに保存されているサンプリング波形名が順番に表示されます。  


## 9. VCO MOD
　VCOのモジュレーション（トレモロとビブラート）を設定します。  
　
### 9-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/04_vca_lfo.jpg) 

### 9-2. TREM (RT1)  

	トレモロのON/OFFを設定します。  
	OFF: トレモロを無効にします。
	ON: トレモロを常時適用します。
	MODLT: モジュレーションホイールによってトレモロを適用します。
	
### 9-3. TrRT (RT2)  

	トレモロの速さを設定します。  
	
### 9-4. TrSC (RT3)  

	トレモロの深さを設定します。  

### 9-5. VIBR (RT4)  

	ビブラートのON/OFFを設定します。  
	OFF: ビブラートを無効にします。
	ON: ビブラートを常時適用します。
	MODLT: モジュレーションホイールによってビブラートを適用します。

### 9-6. ViRT (RT5)  

	ビブラートの速さを設定します。  

### 9-7. ViSC (RT6)  

	ビブラートの深さを設定します。  

### 9-8. CURS (RT7)  

	増減する実数値の桁位置を設定します。  


## 10. OPERATORS
　「OSCW:」で始まる画面で、4個のオペレーターの発信パラメータを設定します。  
　
### 10-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/05_oscillators.jpg) 　

### 10-2. OSCW (RT8/RT1)  

	4オペレーターの切り替えはRT8で行います。[n]で表示されている番号nのオペレーターが編集対象となります。  
	先頭行に[1]とある場合はオペレーター1のパラメータ編集画面です。そこでRT8を右に回すと[2]となり、オペレーター2の編集画面になります。  
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/06_oscillators2.jpg) 　

	[4]の状態でRT8を右に回すと次の画面に移動します。  

	オペレーターの切り替えをします。[n]で表示されている番号nのオペレーターが編集対象となります。  
	
	また、RT1を左右に回すことで、このオペレーターの出力(LEVL)をミュートすることができます。このときLEVLパラメーターの表示がMUTになりますが、LEVLの値自体は変更されません。一時的にオペレーターの出力をなくして音色を確かめたいときに使います。もう一度RT1をどちらかに回すとミュートが解除されます。  
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/06_oscillators3.jpg) 　
	
### 10-3. ALGO (RT2)  

	FM変調のアルゴリズムが表示されます。RT2を左右に回すことでアルゴリズムを変更できます。  
	
### 10-4. WAVE (RT3)  

	基本波形を設定します。以下の波形があります。  

|表記|波形|
|---|---|
|Sin|Sine wave|
|Tri|Triangle wave|
|Sqr|Square wave (duty=50%)|
|aSi|Absolute value of sine wave|
|+Si|Positive value of sine wave|
|Noi|Noise|
|WV1|Sampling wave1|
|WV2|Sampling wave2|
|WV3|Sampling wave3|
|WV4|Sampling wave4|

	WV1〜4はSAMPLING WAVES画面で登録したサンプリング波形のWAVE1〜4に相当します。サンプリング波形が登録されていない場合はノイズが選択されます。  

### 10-5. FREQ (RT4)  

	発信の1周期内に含める基本波形の数（整数倍）を設定します。
	基本波形がNoiseの場合は乱数を発生するシードの値になります。同じ値であれば同じ乱数を発生します。    

### 10-6. DETU (RT5)  

	発信の1周期内に含める基本波形の数（小数部.00〜.99）を設定します。  
	一般に、DETUを0以外にしたオペレーターがあると倍音を合成しやすくなります。  

### 10-7. LEVL (RT6)  

	オペレーターの出力振幅レベルを設定します。数値が大きいほど大きな出力となります。ADJSパラメーターをOFFにしているとき、オーディオ出力用のオペレーター群の合計は255以下にする必要があります。ONのときは自動調整されるので気にする必要はありません。  

### 10-8. FDBK (RT7)  

	フィードバック可能なオペレータでは、自分自身のオペレーターにフィードバックする振幅レベルを設定します。
	フィードバックできないオペレータでは、波形の位相をずらす量を設定します（0〜255が0%〜99%に対応します）  

### 10-9. スライドスイッチ  

	スライドスイッチが0のときは上記数値を1ずつ増減します。1のときは5ずつ増減します。  


## 11. ADDITIVE SYNTHESIS
　「ADDW:」で始まる画面で、8個のサイン波発信器の発信パラメータを設定します。  
　ADDITIVE SYNTHESISは加算波形合成の仕組みで、最大8個のサイン波を加算合成して波形を作り出します。最終的にFM合成された波形に加算されて、音色の元になる波形となります。  
　
### 11-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/16_addwave.jpg) 　

　FREQ, DETU, LEVLの3つで1つのサイン波を出力します。画面上のA, B, C, D列（オシレーターグループ）にはそれぞれ2つのサイン波の設定があり、最大で8個のサイン波を合成できます。  

### 11-2. ADDW (RT8/RT1)  

	オシレーターグループの切り替えはRT8で行います。[n]で表示されている記号のオペレーターが編集対象となります。  
	先頭行に[A]とある場合はオシレーターグループAのパラメータ編集画面です。そこでRT8を右に回すと[B]となり、オシレーターグループBの編集画面になります。  
	
	また、RT1を左右に回すことで、このオシレーターグループの出力(LEVL)をミュートすることができます。このときLEVLパラメーターの表示がMUTになりますが、LEVLの値自体は変更されません。一時的にオペレーターの出力をなくして音色を確かめたいときに使います。もう一度RT1をどちらかに回すとミュートが解除されます。  
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/16_addwave2.jpg) 　

### 11-3. FREQ (RT2/RT5)  

	発信の1周期内に含めるサイン波の数（整数倍）を設定します。  

### 11-4. DETU (RT3/RT6)  

	発信の1周期内に含めるサイン波の数（小数部.00〜.99）を設定します。    

### 11-5. LEVL (RT4/RT7)  

	サイン波の出力振幅レベルを設定します。数値が大きいほど大きな出力となります。ADJSパラメーターをOFFにしているとき、オーディオ出力用のオペレーター群の合計は255以下にする必要があります。ONのときは自動調整されるので気にする必要はありません。  

### 11-6. スライドスイッチ  

	スライドスイッチが0のときは上記数値を1ずつ増減します。1のときは5ずつ増減します。  


## 12. OPERATOR/OSCILLATOR ENVELOPE
　「OSCA:」で始まる画面で、FM合成の4個のオペレーターと加算合成の8個のオシレーターの出力レベルのエンベロープを設定します。出力レベルはオペレーターとオシレーターの出力（LEVL）の値に対して0.0〜1.0の範囲で設定する倍率です。0.0で出力は0になり、1.0で設定した出力値で出力されます。  
　このエンベロープはVCAのエンベロープは別のものですが、VCAエンベロープの変化と同期して動作します。VCAエンベロープのスタート時点、ディケイに移行する時点、サスティーンに移行する時点の3ヶ所（AT, DC, ST）での出力レベルを指定します。  
![OPR/OSC ENVELOPE](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/08_osc_adsr1.png)  

　各オペレーターとオシレーターに付き設定するパラメーターは3ヶ所ですが、内部では中間の4ヶ所が補完されて合計7ヶ所の倍率設定となります。その結果、エンベロープに沿って7個の波形が合成され、ノートオン後のVCAエンベロープの動きに沿って最も近い位置の波形が再生されます。  

　以下は出力レベルのエンベロープによる波形変化の例です。  

|エンベロープ位置|名称|再生波形の例|
|---|---|---|
|AT:ノートオン|ATTACK0|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape1.jpg)|
|ATTACK補完1|ATTACK1|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape2.jpg)|
|ATTACK補完2|ATTACK2|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape3.jpg)|
|DC:ディケイ開始|DECAY0|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape4.jpg)|
|DECAY補完1|DECAY1|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape5.jpg)|
|DECAY補完2|DECAY2|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape6.jpg)|
|ST:サスティーン開始|SUSTAIN|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape7.jpg)|
　
### 12-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/08_osc_adsr.jpg) 　

　設定対象のFM合成オペレーターと加算合成オシレーターの切り替えはRT8で行います。先頭行に[1]とある場合はオペレーター1とオシレーターA列のパラメータ編集画面です。そこでRT8を右に回すと[2]となり、オペレーター2とオシレーターB列の編集画面になります。  
　4個のオペレーターは個々に設定できますが、8個の加算合成オシレーターは2個ずつグループ化されて同じ設定になります。  
　[4]の状態でRT8を右に回すと次の画面に移動します。  

### 12-2. OSCA (RT8)  

	オペレーター＆オシレーターグループの切り替えをします。[n]で表示されている番号nのオペレーター＆オシレーターグループが編集対象となります。  
	
### 12-3. ATfm (RT2)  

	FM合成オペレーター出力エンベロープの最初の倍率（ATTACK0）を0.0〜1.0で設定します。1.0でオペレーターの出力レベルと同じ大きさとなり、レベルを0.0にすると出力はなくなります。  

### 12-4. DCfm (RT3)  

	FM合成オペレーター出力エンベロープのディケイ開始時の倍率（DECAY0）を0.0〜1.0で設定します。1.0でオペレーターの出力レベルと同じ大きさとなり、レベルを0.0にすると出力はなくなります。  

### 12-5. STfm (RT4)  

	FM合成オペレーター出力エンベロープのサスティーン開始時の倍率（SUSTAIN0）を0.0〜1.0で設定します。1.0でオペレーターの出力レベルと同じ大きさとなり、レベルを0.0にすると出力はなくなります。  

### 12-6. ATad (RT5)  

	加算合成オシレーター出力エンベロープの最初の倍率（ATTACK0）を0.0〜1.0で設定します。1.0でオシレーターの出力レベルと同じ大きさとなり、レベルを0.0にすると出力はなくなります。  

### 12-7. DCad (RT6)  

	加算合成オシレーター出力エンベロープのディケイ開始時の倍率（DECAY0）を0.0〜1.0で設定します。1.0でオシレーターの出力レベルと同じ大きさとなり、レベルを0.0にすると出力はなくなります。  

### 12-8. STad (RT7)  

	加算合成オシレーター出力エンベロープのサスティーン開始時の倍率（SUSTAIN）を0.0〜1.0で設定します。1.0でオシレーターの出力レベルと同じ大きさとなり、レベルを0.0にすると出力はなくなります。  


## 13. WAVE SHAPE
　現在の設定で合成された波形群を表示します。波形合成用エンベロープによって生成された7個の波形が順番に表示されます。  
　また、その波形をサンプリング波形としてSDカードに保存できます。保存した波形はオシレーターの波形に利用できるため、音色作成のバリエーションが広がります。  
　保存されるのは波形データであり、音色データではありません。音色はSAVE画面で保存します。  

### 13-1. OLED画面
|エンベロープ位置|名称|画面表示|
|---|---|---|
|AT:ノートオン|ATTACK0|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape1.jpg)|
|ATTACK補完1|ATTACK1|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape2.jpg)|
|ATTACK補完2|ATTACK2|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape3.jpg)|
|DC:ディケイ開始|DECAY0|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape4.jpg)|
|DECAY補完1|DECAY1|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape5.jpg)|
|DECAY補完2|DECAY2|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape6.jpg)|
|ST:サスティーン開始|SUSTAIN|![ATTACK0](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/07_waveshape7.jpg)|

　この波形は波形合成直後のものであり、実際にシンセサイザーが出力する波形ではありません。シンセサイザーが出す音は、さらにFILTERとVCAで変調された波形になります。
	
### 13-2. NAME (RT1)  

	FM変調された波形を保存する名前を設定します。  

### 13-3. CURS (RT2)  

	増減する実数値の桁位置を設定します。  

### 13-4. SAVE (RT3)  

	FM変調された波形をサンプリング波形として保存します。
	RT3を右に回すと「Save?」と確認表示が出ます。さらにRT3を右に回すと実際に保存が行われます。  
	保存した波形データは、サンプリング波形と同じフォーマットのファイルのため、オペレーターの発信波形として使うことができるようになります。4個のオペレーターとアルゴリズムを駆使して作った波形を、たった1個のオペレーターで発信できるようになるわけです。	

![Algorithm](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/mkg_wave_reuse.jpg)  

![Algorithm](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/mkg_wave_reuse_diagram.jpg)  


## 14. FILTER
　「FM変調された波形に適用するフィルターを設定します。
　
### 14-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/09_filter.jpg) 

### 14-2. FILT (RT1)  

	フィルターの種類を設定します。以下のフィルターがあります。  

|表記|フィルター|
|---|---|
|PASS|フィルターを通さず、変調された波形をそのまま出力します。|
|LPF|固定カットオフ周波数のローパスフィルターを通した波形を出力します。|
|HPF|固定カットオフ周波数のハイパスフィルターを通した波形を出力します。|
|BPF|固定カットオフ周波数のバンドパスフィルターを通した波形を出力します。|
|NOTCH|固定カットオフ周波数のノッチフィルターを通した波形を出力します。|
|LPF2|音程カットオフ周波数のローパスフィルターを通した波形を出力します。|
|HPF2|音程カットオフ周波数のハイパスフィルターを通した波形を出力します。|
|BPF2|音程カットオフ周波数のバンドパスフィルターを通した波形を出力します。|
|NOTCH2|音程カットオフ周波数のノッチフィルターを通した波形を出力します。|

	
### 14-3. FREQ (RT2)  

	フィルターのカットオフ周波数を設定します。  
	固定カットオフ周波数のフィルターではカットオフ周波数そのものを指定します。音程カットオフ周波数のフィルターでは、ノートオンした音程の周波数とのオフセット周波数（マイナス値も有効）を指定します。  
	
### 14-4. RESO (RT3)  

	フィルターのQファクター値（レゾナンス）を設定します。  

### 14-5. MODU (RT4)  

	フィルターモジュレーションのON/OFFを設定します。  
	OFF: フィルターモジュレーションを無効にします。
	ON: フィルターモジュレーションを常時適用します。
	MODLT: モジュレーションホイールによってフィルターモジュレーションを適用します。

### 14-6. LFOr (RT5)  

	フィルターモジュレーション用LFOの速さを設定します。  

### 14-7. LFOf (RT6)  

	フィルターモジュレーション用LFOによるカットオフ周波数の最大変動周波数を設定します。  

### 14-8. CURS (RT7)  

	増減する実数値の桁位置を設定します。  


## 15. FILTER ENVELOPE MUDOLATION
　FM変調された波形に適用するフィルターのエンベロープ全体の設定をします。
　
### 15-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/14_filter_envelope.jpg) 
	
### 15-2. FQmx (RT1)  

	フィルターのカットオフ周波数の最大変動幅（周波数）を設定します。マイナスの値の場合はカットオフ周波数が減少する方向へ変動します。  
	
### 15-3. Qfmx (RT2)  

	フィルターのQファクター値の最大変動幅を設定します。マイナスの値の場合はQファクター値が減少する方向へ変動します。    

### 15-4. VELO (RT3)  

	フィルターエンベロープにベロシティーを反映する度合いを設定します。0.0でベロシティーを無視、それ以上の値はベロシティーでエンベロープを大きくする度合いになります。  

### 15-5. KEYS (RT4)  

	キー・スケール・センシティビティーは音程に従ってフィルターの適用度合いを変化させます。値は-9から+9です。  
	0ではキー・スケール・センシティビティーは無効で、全音程でADSRとベロシティーの値に従います。  
	正の値にすると、音程が高くなるにつれてアタックとサステインのレベルが両方とも大きくなります。  
	負の値にすると、音程が高くなるにつれてアタックとサステインのレベルが両方とも小さくなります。  

### 15-6. CURS (RT5)  

	増減する実数値の桁位置を設定します。  


## 16. FILTER ENV
　「FM変調された波形に適用するフィルターのエンベロープのADSRを設定します。
　フィルターエンベロープは以下のパラメータと形状を持っています。  
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/mkg_flt_adsr.png)  
　

### 16-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/15_filter_adsr.jpg) 
	
### 16-2. StLv (RT2)  

	エンベロープの最初のレベル（スタートレベル）を0.0〜1.0で設定します。
	レベル1.0でFQmxと同じ変動となり、レベルを0.0にするとフィルタの設定値のままとなります。  
	
### 16-3. ATCK (RT3)  

	スタートレベルから1.0にまでスイープするエンベロープのアタック秒数を設定します。0は即座に移行することを表します。  

### 16-4. DECY (RT4)  

	アタック完了後にサスティーンレベルまでスイープするエンベロープのディケイ秒数設定します。0は即座に移行することを表します。  

### 16-5. SuLv (RT5)  

	ディケイが完了するレベル（サスティーンレベル）を0.0〜1.0で設定します。  

### 16-6. SuRs (RT6)  

	サスティーンレベルからエンドレベルにスイープするエンベロープのサスティーン秒数設定します。0は即座に移行することを表します。  

### 16-7. EdLv (RT7)  

	最終的なレベルを0.0〜1.0で設定します。  

### 16-8. CURS (RT4)  

	増減する実数値の桁位置を設定します。  


## 17. EFFECTOR
　エフェクターを設定します。
　
### 17-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/18_effector.jpg) 

### 17-2. eDLY (RT1)  

	エコーの反響間隔をミリ秒で設定します。  
	
### 17-3. eDCY (RT2)  

	エコー効果が減衰する比率を設定します。0.00で即時消滅、1.00で減衰しない状態になります。  
	
### 17-4. eMIX (RT3)  

	原音とエコー音のミキシング比率を0.0〜1.0で設定します。0.0で原音のみ、1.00でエコー音のみになります。  
	
### 17-5. PAUS (RT5)  

	MIDI INが一定秒数なかったとき、自動的にオーディオ出力を停止するととともに、編集モード優先動作に移行します。その秒数を指定します。あまり短いと、長い音符を演奏中にオーディオ出力が停止してしまうので注意が必要です。  

### 17-6. CURS (RT6)  

	増減する実数値の桁位置を設定します。  


## 18. VCA
　FM変調された波形に適用するVCAのエンベロープを設定します。
　VCAエンベロープは以下のパラメータと形状を持っています。  
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/mkg_vca_adsr.png)  
　
### 18-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/10_vca.jpg) 

### 18-2. ATCK (RT1)  

	エンベロープのアタック秒数を設定します。  
	
### 18-3. DECY (RT2)  

	エンベロープのディケイ秒数を設定します。  
	
### 18-4. SuLv (RT3)  

	エンベロープのサスティーンレベルを0.0〜1.0で設定します。  

### 18-5. RELS (RT4)  

	エンベロープのリリース秒数を設定します。  

### 18-6. KEYS (RT5)  

	キー・スケール・センシティビティーは音程に従って音量を変化させます。値は-9から+9です。  
	0ではキー・スケール・センシティビティーは無効で、全音程でADSRとベロシティーの値に従います。  
	正の値にすると、音程が高くなるにつれてアタックとサステインのレベルが両方とも大きくなります。  
	負の値にすると、音程が高くなるにつれてアタックとサステインのレベルが両方とも小さくなります。  

### 18-7. ADJS (RT6)  

	FMアルゴリズムのオーディオ出力段にあるオペレーター群と加算合成のオシレーター群の出力レベルの合計は255にすることが基本です。しかし、音作りの過程で複数の出力レベルの配分を確定することは困難です。  
	オーディオ出力レベルの自動調整ADJSをONにすると、オーディオ出力段にある出力レベルの合計が内部的に255になるように自動計算します。見かけの値は変化しません。  
	ADJSをOFFにすると自動調整は働かず、オーディオ出力の合計が255を超えた場合は、上限を超えた波形はクリッピングされます。一般的に音が歪みます。意図的に音の歪みを作り出したい場合はADJSをOFFにして下さい。  

### 18-8. CURS (RT7)  

	増減する実数値の桁位置を設定します。  


## 19. SAVE
　現在の音色パラメータをSDカードに保存します。
　
### 19-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/11_save.jpg) 

### 19-2. BANK (RT2)  

	保存先のバンク番号を設定します。  
	
### 19-3. SOND (RT3)  

	保存先のプログラム番号を設定します。
	保存済みのデータがあるとその音色名も表示されます。  
	
### 19-4. NAME (RT4)  

	音色名を設定します。  

### 19-5. CURS (RT5)  

	増減する実数値の桁位置を設定します。  

### 19-6. TASK (RT6)  

	セーブを実行します。
	RT6を右に回すと「Save?」と確認表示が出ます。さらにRT6を右に回すと実際にセーブされます。  
	RT6を左に回すと「Copy?」と確認表示が出ます。さらにRT6を左に回すとセーブ先の音色名が保存用音色名にコピーされます。  


## 20. LOAD
　SDカードから音色データを読み込んで演奏できるようにします。
　
### 20-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/12_load.jpg) 

### 20-2. BANK (RT2)  

	ロードする音色のあるバンク番号を設定します。  
	
### 20-3. SOND (RT3)  

	ロードする音色のプログラム番号を設定します。
	番号を指定するのではなく、存在する音色リストからの選択になります。  
	
### 20-4. NAME (RT4)  

	ロード対象の音色リストをサーチする文字列を設定します。
	この文字列と部分一致する音色名のみがSOND欄にリストされます（3文字以上のときのみ動作します。3文字以下では全件マッチします）  

### 20-5. CURS (RT5)  

	増減する実数値の桁位置を設定します。  

### 20-6. TASK (RT6)  

	サーチとロードを実行します。
	RT6を左に回すと「Search?」と確認表示が出ます。さらにRT6を左に回すと実際にサーチが行われます。  
	RT6を右に回すと「Load?」と確認表示が出ます。さらにRT6を右に回すと実際にサーチが行われます。  


## 21. SAMPLING
　マイクで拾った音をサンプリングしてサンプリング波形としてSDカードに保存します。  
　サンプリングといっても実験的なおもちゃレベルのものです。一般的なサンプラーのように収録した音を再生するのではなく、マイクで拾った音の先頭部分のごく一部の波形を取り出して波形の素材を作るものです。  
　
### 21-1. OLED画面
![SOUND MAIN](https://github.com/ohira-s/PicoFM_Synth/blob/main/Doc/images/13_sampling.jpg) 

### 21-2. TIME (RT2)  

	サンプリングする時間単位を設定します。
	通常は1で利用します。値を大きくすると波形が複雑になることがあります。  
	
### 21-3. WAIT (RT3)  

	サンプリング実施を指示してから、実際にサンプリングが始まる秒数を指定します。  
	サンプリング前にはLED6が赤く3回点滅し、次に1度青く光り、その直後にサンプリングが開始されます。サンプリング中は緑に点灯しています。  
	
### 21-4. AVRG (RT4)  

	サンプリングした波形の移動平均を取るサンプリング数を指定します。この値が小さいとノイズが多く乗った波形となることが多く、音源としては使いにくくなります。逆に大きすぎると波形が大きく鈍って特徴が失われます。  
	
### 21-5. NAME (RT5)  

	サンプリングした波形の名前を設定します。  

### 21-6. CURS (RT6)  

	増減する実数値の桁位置を設定します。  

### 21-7. TASK (RT7)  

	サンプリング波形の保存をします。
	RT7を右に回すと「Save?」と確認表示が出ます。さらにRT7を右に回すと実際に保存が行われます。  
	
	
　
